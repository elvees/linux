# SPDX-License-Identifier: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/clock/elvees,mcom03-clk-ucg.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: MCom-03 UCG

maintainers:
  - Vasiliy Zasukhin <vzasukhin@elvees.com>

description: |
  MCom-03 SoC has several UCG (Universal Clock Generator). UCG has up to four
  reference clock inputs and up to 16 output channels. Each channel has
  own 20-bit divider and gate. All output channels use single reference clock.
  Some UCGs (in HSPERIPH, LSPERIPH1 and SDR subsystems) can use one of several
  (up to four) reference clocks. In this case reference clock for dividing
  can be selected by reference clock multiplexor (REF MUX).
  MCom-03 datasheet says that REF MUX is part of UCG, but in Linux using
  separate driver for REF MUX is more convenient. This file describes
  only UCG. REF MUX is described in elvees,mcom03-clk-refmux.yaml.
           +---------+   +-------------------+
           | REF MUX |   |         UCG       |
           |         |   |    +------------+ |
           |         |   | +--|-DIV---GATE-|-|- channel 0
  clk_ref0-|         |   | |  +------------+ |
  clk_ref1-|         |---|-+--|-DIV---GATE-|-|- channel 1
  clk_ref2-|         |   | |  +------------+ |
  clk_ref3-|         |   | +................ |...
           |         |   | |  +------------+ |
           |         |   | +--|-DIV---GATE-|-|- channel 15
           |         |   |    +------------+ |
           +---------+   +-------------------+

properties:
  compatible:
    enum:
      - elvees,mcom03-clk-ucg

  clocks:
    maxItems: 1
    description: Input clock

  '#clock-cells':
    const: 1

  reg:
    maxItems: 1

  clock-output-names: true

  clock-indices: true

  assigned-clocks: true

  assigned-clock-rates: true

  enabled-clocks:
    description: Channels that must be enabled at boot

  elvees,fixed-freq-mask:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Bitmask of channels which must not change frequency
    default: 0

  elvees,round-up-mask:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Bitmask of channels for which frequency must be rounded up
    default: 0

required:
  - compatible
  - reg
  - clocks
  - clock-output-names
  - '#clock-cells'

additionalProperties: false

examples:
  - |
    #include <dt-bindings/clock/mcom03-clock.h>
    media_ucg1: ucg@13200c0 {
        compatible = "elvees,mcom03-clk-ucg";
        reg = <0 0x13200c0 0 0x80>;
        clocks = <&media_pll1>;

        clock-output-names = "disp_aclk", "disp_mclk", "disp_pxlclk";
        assigned-clocks = <&media_ucg1 CLK_MEDIA_UCG1_DISP_A>,
                          <&media_ucg1 CLK_MEDIA_UCG1_DISP_M>;
        assigned-clock-rates = <297000000
                                148500000>;
        enabled-clocks = <CLK_MEDIA_UCG1_DISP_A>;
        #clock-cells = <1>;
    };
...
